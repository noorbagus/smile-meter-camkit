var me=Object.defineProperty;var fe=(n,t,r)=>t in n?me(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var C=(n,t,r)=>(fe(n,typeof t!="symbol"?t+"":t,r),r);import{r as l,a as he}from"./vendor-ef065bd6.js";import{b as pe,c as H,T as J}from"./camera-da85d061.js";import{X as B,D as ge,S as xe,C as be,a as we,F as ve,V as ye,R as je,b as Ne,c as Re}from"./icons-23d662e3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();var Q={exports:{}},_={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Se=l,ke=Symbol.for("react.element"),Ce=Symbol.for("react.fragment"),Te=Object.prototype.hasOwnProperty,Ee=Se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ze={key:!0,ref:!0,__self:!0,__source:!0};function ee(n,t,r){var o,s={},a=null,d=null;r!==void 0&&(a=""+r),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(d=t.ref);for(o in t)Te.call(t,o)&&!ze.hasOwnProperty(o)&&(s[o]=t[o]);if(n&&n.defaultProps)for(o in t=n.defaultProps,t)s[o]===void 0&&(s[o]=t[o]);return{$$typeof:ke,type:n,key:a,ref:d,props:s,_owner:Ee.current}}_.Fragment=Ce;_.jsx=ee;_.jsxs=ee;Q.exports=_;var e=Q.exports,K={},q=he;K.createRoot=q.createRoot,K.hydrateRoot=q.hydrateRoot;const I={apiToken:"eyJhbGciOiJIUzI1NiIsImtpZCI6IkNhbnZhc1MyU0hNQUNQcm9kIiwidHlwIjoiSldUIn0.eyJhdWQiOiJjYW52YXMtY2FudmFzYXBpIiwiaXNzIjoiY2FudmFzLXMyc3Rva2VuIiwibmJmIjoxNzQ3MDM1OTAyLCJzdWIiOiI2YzMzMWRmYy0zNzEzLTQwYjYtYTNmNi0zOTc2OTU3ZTkyZGF-UFJPRFVDVElPTn5jZjM3ZDAwNy1iY2IyLTQ3YjEtODM2My1jYWIzYzliOGJhM2YifQ.UqGhWZNuWXplirojsPSgZcsO3yu98WkTM1MRG66dsHI",lensId:"04441cd2-8e9d-420b-b293-90b5df8f577f",lensGroupId:"a0fecab7-26c6-4d63-9101-d25ff7fdd6ee",canvas:{width:window.innerWidth,height:window.innerHeight},camera:{facingMode:"user",audio:!0},recording:{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5}},Ie=()=>{const{apiToken:n,lensId:t,lensGroupId:r}=I;if(!n||n==="YOUR_API_TOKEN_HERE")throw new Error("API Token is required");if(!t||t==="YOUR_LENS_ID_HERE")throw new Error("Lens ID is required");if(!r||r==="YOUR_LENS_GROUP_ID_HERE")throw new Error("Lens Group ID is required");return!0},Le="modulepreload",Me=function(n){return"/web-ar/"+n},X={},Pe=function(t,r,o){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(a=>{if(a=Me(a),a in X)return;X[a]=!0;const d=a.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(!!o)for(let p=s.length-1;p>=0;p--){const f=s[p];if(f.href===a&&(!d||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${g}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Le,d||(h.as="script",h.crossOrigin=""),h.href=a,document.head.appendChild(h),d)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t()).catch(a=>{const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a})},L=()=>/Android/i.test(navigator.userAgent),_e=()=>{const n=L(),t=n?["video/mp4;codecs=avc1.42E01E,mp4a.40.2","video/mp4;codecs=h264,aac","video/mp4","video/webm;codecs=vp9,opus","video/webm"]:["video/mp4;codecs=h264,aac","video/mp4","video/webm;codecs=vp9,opus","video/webm"];for(const r of t)if(MediaRecorder.isTypeSupported(r))return{mimeType:r,videoBitsPerSecond:n?15e5:25e5,audioBitsPerSecond:128e3,audioBitrateMode:"constant",keyFrameInterval:30};return{videoBitsPerSecond:2e6,audioBitsPerSecond:128e3}};class Oe{constructor(t,r,o){C(this,"recorder",null);C(this,"chunks",[]);C(this,"startTime",0);C(this,"recordingTimer",null);C(this,"isAndroid");this.stream=t,this.onComplete=r,this.addLog=o,this.isAndroid=L()}start(){const t=_e();try{this.recorder=new MediaRecorder(this.stream,t),this.chunks=[],this.startTime=Date.now(),this.recorder.ondataavailable=o=>{o.data&&o.data.size>0&&this.chunks.push(o.data)},this.recorder.onstop=()=>{this.processRecording()},this.recorder.onerror=o=>{this.addLog(`❌ Recording error: ${o}`)};const r=this.isAndroid?100:1e3;this.recorder.start(r),this.addLog(`🎬 Recording started (${this.isAndroid?"Android MP4":"Standard"} mode)`)}catch(r){throw this.addLog(`❌ MediaRecorder creation failed: ${r}`),r}}stop(){this.recorder&&this.recorder.state==="recording"&&(this.recordingTimer&&clearTimeout(this.recordingTimer),this.isAndroid?this.recordingTimer=setTimeout(()=>{var t;(t=this.recorder)==null||t.stop()},200):this.recorder.stop())}async processRecording(){var t;try{const r=Date.now()-this.startTime,o=Math.floor(r/1e3);if(this.chunks.length===0)throw new Error("No recorded data available");const s=((t=this.recorder)==null?void 0:t.mimeType)||"video/mp4",a=s.includes("mp4"),d=new Blob(this.chunks,{type:a?"video/mp4":s});let g;try{const N=(await Pe(()=>import("./fix-webm-duration-e8adce03.js").then(O=>O.f),["assets/fix-webm-duration-e8adce03.js","assets/vendor-ef065bd6.js"])).default;g=await N(d,r),this.addLog(`✅ Duration metadata fixed: ${o}s`)}catch(N){this.addLog(`⚠️ Duration fix failed: ${N}`),g=d}const E=Date.now(),p=`lens_video_${E}.${a?"mp4":"webm"}`,f=new File([g],p,{type:g.type,lastModified:E});f.recordingDuration=o,f.isAndroidRecording=this.isAndroid,f.originalMimeType=s,f.optimizedForSharing=this.isAndroid&&a,this.addLog(`✅ Recording processed: ${o}s, ${this.formatFileSize(f.size)}, ${f.type}`),this.onComplete(f)}catch(r){throw this.addLog(`❌ Processing failed: ${r}`),r}}formatFileSize(t){return`${(t/1048576).toFixed(1)}MB`}getState(){var t;return((t=this.recorder)==null?void 0:t.state)||"inactive"}}const Ae=n=>{const t=n.type.includes("mp4"),r=n.size,o=n.recordingDuration||0;return{instagram:t&&r<100*1024*1024&&o<=60,tiktok:t&&r<72*1024*1024&&o<=60,youtube:t&&r<256*1024*1024,twitter:t&&r<512*1024*1024&&o<=140}};let T=null,Z=!1,z=null;const te=async()=>T||z||(z=(async()=>{try{return Z=!0,console.log("🚀 Preloading Camera Kit..."),Ie(),T=await pe({apiToken:I.apiToken}),console.log("✅ Camera Kit preloaded"),T}catch(n){throw console.error("❌ Failed to preload Camera Kit:",n),T=null,z=null,n}finally{Z=!1}})(),z);te().catch(console.error);const Fe=({outputCanvas:n})=>{const t=l.useRef(null);return l.useEffect(()=>{if(n&&t.current){const r=t.current;r.innerHTML="",r.appendChild(n)}},[n]),e.jsx("div",{ref:t,className:"absolute inset-0 w-full h-full"})},$e=()=>{const[n,t]=l.useState("user"),[r,o]=l.useState("initializing"),[s,a]=l.useState("idle"),[d,g]=l.useState(null),[E,h]=l.useState(!1),[p,f]=l.useState(!1),[N,O]=l.useState(!1),[A,Y]=l.useState(0),[re,ie]=l.useState([]),F=l.useRef(null),x=l.useRef(null),b=l.useRef(null),y=l.useRef(null),R=l.useRef(null),M=l.useRef(!1),$=l.useRef(null),j=l.useRef(null),c=l.useCallback(i=>{const m=`[${new Date().toLocaleTimeString()}] ${i}`;console.log(m),ie(w=>[...w.slice(-10),m])},[]),D=l.useCallback(i=>{i&&(R.current=i,i.style.cssText=`
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      inset: 0;
    `,i.className="absolute inset-0 w-full h-full object-cover",M.current=!0,c("✅ Camera output configured"))},[c]),U=l.useCallback(async()=>{try{c("🚀 Starting Camera Kit initialization..."),o("initializing");const i=navigator.mediaDevices.getUserMedia({video:{facingMode:n,width:{ideal:1280,min:640},height:{ideal:720,min:480}},audio:I.camera.audio});let u=T;if(u||(c("Camera Kit not preloaded, bootstrapping now..."),u=await te()),!u)throw new Error("Failed to initialize Camera Kit instance");const[m,w]=await Promise.all([u.createSession(),i]);b.current=m,x.current=w,c("✅ Session and stream ready"),m.events.addEventListener("error",v=>{c(`❌ Session error: ${v.detail}`),o("error")});const P=H(w);if(await m.setSource(P),n==="user"&&P.setTransform(J.MirrorX),c("✅ Camera source configured"),!$.current){const{lenses:v}=await u.lensRepository.loadLensGroups([I.lensGroupId]);$.current=v,c("✅ Lens repository cached")}const k=$.current;if(k&&k.length>0){const v=k.find(ue=>ue.id===I.lensId)||k[0];await m.applyLens(v),c(`✅ Lens applied: ${v.name}`)}m.play("live"),F.current&&m.output.live&&!M.current&&D(m.output.live),o("ready"),c("🎉 Camera Kit initialization complete")}catch(i){const u=i instanceof Error?i.message:String(i);c(`❌ Camera Kit error: ${u}`),console.error("Camera Kit initialization failed:",i),o("error")}},[n,c,D]),se=l.useCallback(async()=>{if(!(!b.current||r!=="ready"))try{o("initializing");const i=n==="user"?"environment":"user";c(`🔄 Switching to ${i} camera`),b.current.pause(),x.current&&x.current.getTracks().forEach(w=>w.stop());const u=await navigator.mediaDevices.getUserMedia({video:{facingMode:i,width:{ideal:1280,min:640},height:{ideal:720,min:480}},audio:!0});x.current=u;const m=H(u);await b.current.setSource(m),i==="user"&&m.setTransform(J.MirrorX),b.current.play("live"),t(i),o("ready"),c(`✅ Switched to ${i} camera`)}catch(i){c(`❌ Camera switch failed: ${i}`),o("error")}},[n,r,c]),G=l.useCallback(()=>{if(!x.current||r!=="ready"){c("❌ Cannot start recording - stream not ready");return}try{const i=R.current;if(!i){c("❌ Canvas not available for AR recording");return}const u=i.captureStream(24);if(x.current.getAudioTracks().length>0){const m=x.current.getAudioTracks()[0];u.addTrack(m)}j.current=new Oe(u,m=>{g(m),h(!0),a("idle"),c("✅ AR recording completed")},c),j.current.start(),a("recording"),c("🎬 AR recording started")}catch(i){c(`❌ Failed to start AR recording: ${i}`),a("idle")}},[r,c]),W=l.useCallback(()=>{j.current&&s==="recording"&&(j.current.stop(),a("processing"),c("⏹️ Enhanced recording stopped"))},[s,c]),ne=l.useCallback(()=>{s==="recording"?A>=2&&W():G()},[s,A,G,W]),oe=async()=>{if(!d)return;const i=await d.arrayBuffer(),u=new File([i],"video.mp4",{type:"video/mp4",lastModified:Date.now()});await navigator.share({files:[u]})},ae=()=>{if(!d)return;const i=URL.createObjectURL(d),u=document.createElement("a");u.href=i,u.download="lens-video"+(d.type.includes("mp4")?".mp4":".webm"),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(i),c("💾 Video downloaded")},V=l.useCallback(()=>{j.current&&(j.current.stop(),j.current=null),x.current&&(x.current.getTracks().forEach(i=>i.stop()),c("🔄 Camera stream stopped")),b.current&&(b.current.pause(),c("⏸️ Camera Kit session paused")),y.current&&clearInterval(y.current)},[c]),ce=()=>{h(!1),g(null),b.current&&b.current.play("live"),M.current=!1,setTimeout(()=>{R.current&&F.current&&!M.current&&D(R.current)},200)};l.useEffect(()=>(c("🎬 Component mounted - starting initialization"),U(),V),[U,V,c]),l.useEffect(()=>(s==="recording"?y.current=setInterval(()=>{Y(i=>i+1)},1e3):(y.current&&clearInterval(y.current),Y(0)),()=>{y.current&&clearInterval(y.current)}),[s]);const le=i=>{const u=Math.floor(i/60),m=i%60;return`${u.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`},S=({icon:i,onClick:u,label:m,className:w="",size:P="md",disabled:k=!1})=>{const v={sm:"w-10 h-10",md:"w-12 h-12",lg:"w-16 h-16"};return e.jsx("button",{onClick:u,disabled:k,className:`
          ${v[P]} 
          rounded-full 
          backdrop-blur-md 
          bg-white/20 
          border 
          border-white/30 
          flex 
          items-center 
          justify-center 
          text-white 
          hover:bg-white/30 
          transition-all 
          duration-200 
          active:scale-95
          disabled:opacity-50
          disabled:cursor-not-allowed
          ${w}
        `,children:e.jsx(i,{className:"w-5 h-5"})})},de=()=>e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:ne,disabled:r!=="ready",className:`
          w-20 h-20 
          rounded-full 
          border-4 
          border-white 
          flex 
          items-center 
          justify-center 
          transition-all 
          duration-200 
          active:scale-95
          disabled:opacity-50
          ${s==="recording"?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30 backdrop-blur-md"}
        `,children:s==="recording"?e.jsx(Ne,{className:"w-8 h-8 text-white fill-white"}):s==="processing"?e.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Re,{className:"w-12 h-12 text-red-500 fill-red-500"})}),s==="recording"&&e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:le(A)})})]});return E&&d?(d.isAndroidRecording,Ae(d),e.jsxs("div",{className:"fixed inset-0 bg-black flex flex-col",children:[e.jsx("div",{className:"absolute top-0 inset-x-0 p-4 bg-gradient-to-b from-black/50 to-transparent z-20",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:ce,className:"w-10 h-10 rounded-full bg-white/20 backdrop-blur-md border border-white/30 flex items-center justify-center text-white",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsx("div",{className:"text-center",children:e.jsx("h2",{className:"text-white font-semibold",children:"Preview"})}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("video",{src:URL.createObjectURL(d),controls:!0,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,preload:"metadata",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 p-6 bg-gradient-to-t from-black/50 to-transparent z-20",children:e.jsxs("div",{className:"flex items-center justify-center space-x-8",children:[e.jsx(S,{icon:ge,onClick:ae,label:"Download",size:"lg"}),e.jsx(S,{icon:xe,onClick:oe,label:"Share",size:"lg"})]})})]})):e.jsx("div",{className:"fixed inset-0 bg-black flex flex-col",children:e.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"}),e.jsxs("div",{ref:F,className:`absolute inset-0 transition-transform duration-300 ${N?"scale-x-[-1]":""}`,children:[e.jsx(Fe,{outputCanvas:R.current}),!R.current&&e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-pink-500/20 via-purple-500/20 to-blue-500/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-white/50 text-center",children:[e.jsx(be,{className:"w-16 h-16 mx-auto mb-4"}),e.jsxs("p",{children:["Camera Feed ",r==="ready"?"(Live)":"(Loading...)"]}),e.jsxs("p",{className:"text-sm mt-2",children:["State: ",r]}),L()&&r==="ready"&&e.jsx("p",{className:"text-xs mt-1 text-green-400",children:"📱 Android MP4 Ready"})]})})]}),e.jsx("div",{className:"absolute top-0 inset-x-0 p-4 bg-gradient-to-b from-black/50 to-transparent z-10",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(S,{icon:we,onClick:()=>f(!p),label:"Settings"}),e.jsx("div",{className:"text-white text-center",children:e.jsx("img",{src:"images/attribution.png",alt:"Attribution",className:"h-4 mx-auto"})}),e.jsx(S,{icon:ve,onClick:()=>O(!N),label:"Flip"})]})}),s==="recording"&&e.jsxs("div",{className:"absolute top-20 left-4 flex items-center space-x-2 bg-red-500/80 backdrop-blur-md rounded-full px-3 py-2 z-10",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsxs("span",{className:"text-white text-sm font-medium",children:["REC ",L()?"(MP4)":""]})]}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 p-6 bg-gradient-to-t from-black/50 to-transparent z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{icon:ye,onClick:()=>c("Gallery clicked"),label:"Gallery",size:"lg"}),e.jsx(de,{}),e.jsx(S,{icon:je,onClick:se,label:"Switch Camera",size:"lg"})]})}),r==="initializing"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-30",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-6",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-white/20 rounded-full"}),e.jsx("div",{className:"absolute inset-0 w-16 h-16 border-4 border-white border-t-transparent rounded-full animate-spin"})]}),e.jsx("div",{className:"text-white text-lg font-medium mb-2",children:"Initializing Web AR Netramaya..."})]})}),r==="error"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-30",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(B,{className:"w-8 h-8 text-red-400"})}),e.jsx("div",{className:"text-white text-lg font-medium mb-2",children:"AR Camera Error"}),e.jsx("div",{className:"text-white/60 text-sm mb-4",children:"Please check your configuration"}),e.jsx("button",{onClick:U,className:"px-4 py-2 bg-white/20 rounded-lg text-white hover:bg-white/30 transition-colors",children:"Retry"})]})}),p&&e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm z-30 p-6",children:e.jsxs("div",{className:"bg-white/10 rounded-lg p-6 max-w-md mx-auto mt-20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-white text-lg font-semibold",children:"Settings"}),e.jsx("button",{onClick:()=>f(!1),className:"text-white/60 hover:text-white",children:e.jsx(B,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-white/80 text-sm",children:[e.jsx("p",{className:"mb-2",children:"🎬 Recording Format:"}),e.jsx("p",{className:"text-xs text-white/60",children:L()?"📱 Android: MP4 (H.264) - Optimized for Instagram/TikTok":"💻 Standard: MP4/WebM - Universal compatibility"})]}),e.jsxs("div",{className:"text-white/80 text-sm",children:[e.jsx("p",{className:"mb-2",children:"📊 Debug Logs:"}),e.jsx("div",{className:"bg-black/30 rounded p-2 text-xs font-mono max-h-32 overflow-y-auto",children:re.slice(-5).map((i,u)=>e.jsx("div",{className:"text-white/60",children:i},u))})]})]})]})})]})})};K.createRoot(document.getElementById("root")).render(e.jsx($e,{}));
